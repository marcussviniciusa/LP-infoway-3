<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infoway - Soluções em Internet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Hero Section -->
    <section class="hero-section" id="home">
        <div class="container h-100">
            <div class="row h-100 align-items-center">
                <div class="col-lg-8 mx-auto text-center">
                    <div class="hero-content">
                        <a href="https://wa.me/5583987224143?text=Ol%C3%A1%2C%20tenho%20interesse%2C%20vim%20do%20an%C3%BAncio%21%21" class="btn btn-primary btn-lg">Fale com um Consultor</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Plans Section -->
    <section class="plans-section">
        <div class="plans-container">
            <div class="side-plan">
                <img src="/files/model-planos-e.png" alt="Plano Esquerdo" class="plan-image">
            </div>
            <div class="center-plan">
                <img src="/files/planos.png" alt="Plano Central" class="plan-image">
            </div>
            <div class="side-plan">
                <img src="/files/model-planos-d.png" alt="Plano Direito" class="plan-image">
            </div>
        </div>
        <div class="plans-button-container">
            <a href="https://wa.me/5583987224143?text=Ol%C3%A1%2C%20tenho%20interesse%2C%20vim%20do%20an%C3%BAncio%21%21" class="btn btn-primary btn-lg">Contrate Agora</a>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials-section">
        <h1 class="testimonials-title">Quem entende o valor de estar conectado, escolhe a InfoWay.</h1>
        <div class="testimonials-container">
            <div class="testimonial-card">
                <img src="/files/prova (3).png" alt="Depoimento Helena" class="testimonial-image">
            </div>
            <div class="testimonial-card">
                <img src="/files/prova (2).png" alt="Depoimento Roberto" class="testimonial-image">
            </div>
            <div class="testimonial-card">
                <img src="/files/prova (1).png" alt="Depoimento Isabeli" class="testimonial-image">
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section" id="features">
        <div class="container">
            <h2 class="text-center mb-5">Por que escolher a Infoway?</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-bolt feature-icon"></i>
                        <h3>Alta Velocidade</h3>
                        <p>Internet rápida e estável para todas as suas necessidades</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-headset feature-icon"></i>
                        <h3>Suporte 24/7</h3>
                        <p>Atendimento técnico disponível 24 horas por dia</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-shield-alt feature-icon"></i>
                        <h3>Conexão Segura</h3>
                        <p>Sua navegação protegida com as melhores tecnologias</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <h2 class="mb-4">Pronto para ter a melhor internet?</h2>
            <p class="lead mb-4">Entre em contato conosco e conheça nossos planos</p>
            <a href="https://wa.me/5583987224143?text=Ol%C3%A1%2C%20tenho%20interesse%2C%20vim%20do%20an%C3%BAncio%21%21" class="btn btn-primary btn-lg">Solicitar Orçamento</a>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="py-5" id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 mx-auto">
                    <div class="contact-form">
                        <h2 class="text-center mb-4">Fale Conosco</h2>
                        <form id="contactForm">
                            <div class="mb-3">
                                <input type="text" class="form-control" name="nome" placeholder="Nome completo" required>
                            </div>
                            <div class="mb-3">
                                <input type="email" class="form-control" name="email" placeholder="E-mail" required>
                            </div>
                            <div class="mb-3">
                                <input type="tel" class="form-control" name="phone" placeholder="Telefone" required>
                            </div>
                            <div class="mb-3">
                                <input type="text" class="form-control" name="cpf_cnpj" placeholder="CPF ou CNPJ" required>
                            </div>
                            <div class="mb-3">
                                <textarea class="form-control" name="mensagem" rows="4" placeholder="Mensagem"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Enviar Mensagem</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <img src="/files/logo (1).png" alt="Infoway Logo" style="height: 40px; margin-bottom: 20px;">
                    <p>Fornecendo internet de qualidade para milhares de clientes.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>Contato: (83) 3142-0005</p>
                    <p>Email: contato@infowaynet.com.br</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/5583987224143?text=Ol%C3%A1%2C%20tenho%20interesse%2C%20vim%20do%20an%C3%BAncio%21%21" class="whatsapp-float">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Função para enviar eventos para a API do Meta
        async function sendMetaEvent(eventName, userData = {}, customData = {}) {
            try {
                console.log('Enviando evento para Meta:', { eventName, userData, customData });
                const response = await fetch('/api/meta-conversion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        eventName,
                        userData,
                        customData
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send event');
                }
                
                const responseData = await response.json();
                console.log('Resposta do Meta:', responseData);
            } catch (error) {
                console.error('Error sending event:', error);
            }
        }

        // Manipulação do envio do formulário
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                // Capturar dados do formulário
                const nome = this.querySelector('[name="nome"]').value;
                const email = this.querySelector('[name="email"]').value;
                const phone = this.querySelector('[name="phone"]').value;
                const cpfCnpj = this.querySelector('[name="cpf_cnpj"]').value;
                
                // Validar dados obrigatórios
                if (!nome || !email || !phone || !cpfCnpj) {
                    throw new Error('Por favor, preencha todos os campos obrigatórios.');
                }

                // Rastrear evento via pixel (com tratamento de erro)
                try {
                    if (typeof fbq === 'function') {
                        fbq('track', 'Lead', {
                            content_name: 'Formulário de Contato',
                            value: 0,
                            currency: 'BRL'
                        });
                    } else {
                        console.warn('Pixel do Facebook não encontrado - evento será enviado apenas via API');
                    }
                } catch (pixelError) {
                    console.warn('Erro ao enviar evento para o pixel:', pixelError);
                }

                // Preparar dados para a API do IXC
                const formData = {
                    nome: nome,
                    email: email,
                    fone_celular: phone.replace(/\D/g, ''),
                    cnpj_cpf: cpfCnpj.replace(/\D/g, ''),
                    data_cadastro: new Date().toISOString().split('T')[0],
                    lead: "S",
                    ativo: "S"
                };

                console.log('Dados a serem enviados:', formData);

                // Tentar criar o lead
                const response = await fetch('/api/create-lead', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Erro ao enviar formulário');
                }

                const responseData = await response.json();
                console.log('Resposta da API:', responseData);

                if (responseData.success) {
                    alert('Mensagem enviada com sucesso! Entraremos em contato em breve.');
                    this.reset();
                } else {
                    throw new Error(responseData.error || 'Falha ao enviar dados');
                }
            } catch (error) {
                console.error("Detalhes do erro:", error);
                alert(`Desculpe, ocorreu um erro: ${error.message}`);
                
                // Se houver erro, oferece alternativa via WhatsApp
                const whatsappNumber = "5583987224143";
                const whatsappMessage = `Olá! Tentei enviar pelo formulário mas tive um problema. Seguem meus dados para contato:\n\nNome: ${nome}\nTelefone: ${phone}\nCPF/CNPJ: ${cpfCnpj}\nE-mail: ${email}\n\nGostaria de mais informações sobre os planos de internet.`;
                
                if (confirm('Deseja tentar enviar os dados via WhatsApp?')) {
                    window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`, '_blank');
                }
            }
        });

        // Adicionar rastreamento de eventos nos botões de WhatsApp
        document.querySelectorAll('a[href*="wa.me"]').forEach(button => {
            button.addEventListener('click', function() {
                // Rastrear evento via pixel (com tratamento de erro)
                try {
                    if (typeof fbq === 'function') {
                        fbq('track', 'Contact');
                    } else {
                        console.warn('Pixel do Facebook não encontrado');
                    }
                } catch (pixelError) {
                    console.warn('Erro ao enviar evento para o pixel:', pixelError);
                }
                
                // Rastrear evento via API de Conversões
                sendMetaEvent('Contact', {
                    client_user_agent: navigator.userAgent
                });
            });
        });

        // Função para gerar hash SHA-256
        async function sha256(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Formatação do CPF/CNPJ
        document.querySelector('input[name="cpf_cnpj"]').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) { // CPF
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
            } else { // CNPJ
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, "$1.$2.$3/$4-$5");
            }
            e.target.value = value;
        });

        // Formatação do telefone
        document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
            }
            e.target.value = value;
        });

        // Smooth scrolling para links âncora
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
